{"version":3,"sources":["variables.js","index.js"],"names":["topLevelFrameBlocks","UIStrings","invoiceString","phoneString","searchButtonString","clearButtonString","routeString","weightString","placesString","statusString","requestString","yesString","noString","returnString","redirectString","headerString","footerString","resultString","url","requestOptions","mode","cache","redirect","method","freshnessTime","DOMFrameBlocks","renderSemanticBlock","block","renderHeader","innerHTML","renderFooter","length","getTrackingData","event","preventDefault","requestSets","Array","from","document","querySelectorAll","styles","request_set","requestedDocuments","forEach","prepareDocuments","requestItem","push","DocumentNumber","querySelector","value","Phone","requestTemplate","modelName","calledMethod","methodProperties","Language","documentsForRender","documentsForDownload","checkLocalStorage","requestedItem","index","localStorage","getItem","JSON","parse","requestTime","Date","renderResult","Documents","body","stringify","fetch","then","response","json","result","manageResults","downloadedResults","shift","setItem","Number","data","catch","err","console","error","resultsData","trackingResultFields","tracking_result","item","tracking_result__wrapper","tracking_result__caption","tracking_result__text","CitySender","CityRecipient","DocumentWeight","SeatsAmount","Status","PossibilityCreateReturn","request_action","status","PossibilityCreateRedirecting","resetApp","requestSet","remove","forms","request_form","reset","renderMain","tracking_form","renderRequestSet","request_submit","renderDynamicBlocks","request_item","request_add_set","request_remove_set","addRequestSet","target","parentNode","insertAdjacentHTML","removeRequestSet","window","topLevelFrameString","reduce","renderString","renderApp"],"mappings":"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","file":"framework_task.7e386f39.js","sourceRoot":"..","sourcesContent":["export const topLevelFrameBlocks = ['header', 'main', 'footer'];\n\nexport const UIStrings = {\n  invoiceString: 'Введите номер квитанции',\n  phoneString: 'Введите номер телефона',\n  searchButtonString: 'Искать',\n  clearButtonString: 'Очистить',\n  routeString: 'Маршрут',\n  weightString: 'Вес, кг',\n  placesString: 'Мест',\n  statusString: 'Текущий статус',\n  requestString: 'Заказать',\n  yesString: 'да',\n  noString: 'нет',\n  returnString: 'Можно вернуть',\n  redirectString: 'Можно переслать',\n  headerString: 'Трекинг посылок Новой почты',\n  footerString: 'Версия 1.3',\n  resultString: 'Результат',\n};\n\n// export const apiKey = '797cc99d2a4af108e6d6770516130d77';\nexport const url = 'https://api.novaposhta.ua/v2.0/json/';\n\nexport const requestOptions = {\n  // contentType: 'application/json',\n  mode: 'cors',\n  cache: 'no-cache',\n  redirect: 'follow',\n  method: 'POST',\n  // dataType: 'jsonp',\n};\n\nexport const freshnessTime = 18000000;\n","import {\n  topLevelFrameBlocks,\n  UIStrings,\n  requestOptions,\n  // apiKey,\n  url,\n  freshnessTime,\n} from './variables.js';\n\nimport styles from './style';\nconst DOMFrameBlocks = [];\n\nfunction renderSemanticBlock(block) {\n  return `<${block}></${block}>`;\n}\n\nfunction renderHeader() {\n  DOMFrameBlocks[0].innerHTML = `<h1>${UIStrings.headerString}</h1>`;\n}\n\nfunction renderFooter() {\n  DOMFrameBlocks[DOMFrameBlocks.length - 1].innerHTML = `${UIStrings.footerString}`;\n}\n\nfunction getTrackingData(event) {\n  event.preventDefault();\n  const requestSets = Array.from(document.querySelectorAll(`.${styles.request_set}`));\n  const requestedDocuments = [];\n  requestSets.forEach(prepareDocuments);\n\n  function prepareDocuments(requestItem) {\n    requestedDocuments.push({\n      DocumentNumber: requestItem.querySelector('input[name = invoice_number]').value,\n      Phone: requestItem.querySelector('input[name = phone_number]').value,\n    });\n  }\n\n  const requestTemplate = {\n    modelName: 'TrackingDocument',\n    calledMethod: 'getStatusDocuments',\n    methodProperties: {\n      Language: 'RU',\n    },\n  };\n\n  const documentsForRender = [];\n  const documentsForDownload = [];\n  requestedDocuments.forEach(checkLocalStorage);\n  function checkLocalStorage(requestedItem, index) {\n    if (\n      localStorage.getItem(requestedItem.DocumentNumber) &&\n      JSON.parse(localStorage.getItem(requestedItem.DocumentNumber)).requestTime >\n        new Date() - freshnessTime\n    ) {\n      documentsForRender[index] = JSON.parse(localStorage.getItem(requestedItem.DocumentNumber));\n    } else {\n      documentsForDownload.push(requestedItem);\n      documentsForRender[index] = 'gotToBeDownloaded';\n    }\n  }\n\n  if (documentsForDownload.length == 0) {\n    renderResult(documentsForRender);\n  } else {\n    requestTemplate.methodProperties.Documents = documentsForDownload;\n    requestOptions.body = JSON.stringify(requestTemplate);\n\n    fetch(url, requestOptions)\n      .then(response => {\n        return response.json();\n      })\n      .then(result => {\n        manageResults(result.data);\n      })\n      .catch(err => {\n        console.error('there was some error:', err);\n      });\n  }\n\n  function manageResults(downloadedResults) {\n    documentsForRender.forEach((result, index) => {\n      if (result == 'gotToBeDownloaded') {\n        result = downloadedResults.shift();\n        result.requestTime = +new Date();\n        localStorage.setItem(result.Number, JSON.stringify(result));\n        documentsForRender[index] = result;\n      }\n    });\n    renderResult(documentsForRender);\n  }\n}\n\nfunction renderResult(resultsData) {\n  const trackingResultFields = Array.from(document.querySelectorAll(`.${styles.tracking_result}`));\n  resultsData.forEach((item, index) => {\n    trackingResultFields[index].innerHTML = `<h2>${UIStrings.resultString}:</h2>\n  <div class=${styles.tracking_result__wrapper}>\n    <div class=${styles.tracking_result__caption}>${UIStrings.routeString}:</div>\n    <div class=${styles.tracking_result__text}>${item.CitySender}-${item.CityRecipient}</div>\n    <div class=${styles.tracking_result__caption}>${UIStrings.weightString}:</div>\n    <div class=${styles.tracking_result__text}>${item.DocumentWeight}</div>\n    <div class=${styles.tracking_result__caption}>${UIStrings.placesString}:</div>\n    <div class=${styles.tracking_result__text}>${item.SeatsAmount}</div>\n    <div class=${styles.tracking_result__caption}>${UIStrings.statusString}:</div>\n    <div class=${styles.tracking_result__text}>${item.Status}</div>\n    <div class=${styles.tracking_result__caption}>${UIStrings.returnString}:</div>\n    <div class=${styles.tracking_result__text}>${\n      item.PossibilityCreateReturn ? UIStrings.yesString : UIStrings.noString\n    }<input type=\"button\" class=${styles.request_action} disabled value=\"${\n      UIStrings.requestString\n    }\"/></div>\n    <div class=${styles.tracking_result__caption}>${UIStrings.redirectString}:</div>\n    <div class=\"${styles.tracking_result__text} ${styles.tracking_result__text - status}\">${\n      item.PossibilityCreateRedirecting ? UIStrings.yesString : UIStrings.noString\n    }<input type=\"button\" class=${styles.request_action} disabled value=\"${\n      UIStrings.requestString\n    }\"/></div>\n  </div>`;\n  });\n}\n\nwindow.getTrackingData = getTrackingData;\nwindow.addRequestSet = addRequestSet;\nwindow.removeRequestSet = removeRequestSet;\nwindow.resetApp = resetApp;\n\nfunction resetApp() {\n  const requestSets = Array.from(document.querySelectorAll(`.${styles.request_set}`));\n  requestSets.forEach((requestSet, index) => {\n    if (index > 0) {\n      requestSet.remove();\n    }\n  });\n  if (document.querySelector(`.${styles.tracking_result}`)) {\n    document.querySelector(`.${styles.tracking_result}`).innerHTML = '';\n  }\n  document.forms.request_form.reset();\n}\n\nfunction renderMain() {\n  DOMFrameBlocks[1].innerHTML = `\n       <div class=${styles.tracking_form}>\n      <form name=\"request_form\" autocomplete=\"off\" onsubmit=\"getTrackingData(event)\">\n        ${renderRequestSet()}\n        <input type=\"submit\" value=\"${UIStrings.searchButtonString}\" class=${\n    styles.request_submit\n  } />\n        <input type=\"button\" value=\"${UIStrings.clearButtonString}\" class=${\n    styles.request_submit\n  } onclick=\"resetApp()\" />\n      </form>\n    </div>`;\n}\n\nfunction renderDynamicBlocks() {\n  renderHeader();\n  renderFooter();\n  renderMain();\n}\n\nfunction renderRequestSet() {\n  return `<div class=${styles.request_set}>\n            <div class=${styles.request_item}>\n              <input type=\"text\" name=\"invoice_number\" value=\"\" placeholder=\" \" required/>\n              <label for=\"invoice_number\">${UIStrings.invoiceString}</label>\n            </div>\n            <div class=${styles.request_item}>\n              <input type=\"text\" name=\"phone_number\" value=\"\" pattern=\"[0-9]{0,10}\" placeholder=\" \"/>\n              <label for=\"phone_number\">${UIStrings.phoneString}</label>\n            </div>\n            <input type=\"button\" class=${styles.request_add_set} onclick=\"addRequestSet(event)\" value=\"+\"/>\n            <input type=\"button\" class=${styles.request_remove_set} onclick=\"removeRequestSet(event)\" value=\"-\"/>\n            <div class=${styles.tracking_result}></div>\n          </div>`;\n}\n\nfunction addRequestSet(event) {\n  event.target.parentNode.insertAdjacentHTML('afterend', `${renderRequestSet()}`);\n}\n\nfunction removeRequestSet() {\n  event.target.parentNode.remove();\n}\n\nlet topLevelFrameString = topLevelFrameBlocks.reduce(\n  (renderString, item) => (renderString += renderSemanticBlock(item)),\n  '',\n);\n\nfunction renderApp() {\n  document.body.insertAdjacentHTML('afterbegin', topLevelFrameString);\n  topLevelFrameBlocks.forEach(item => DOMFrameBlocks.push(document.querySelector(`${item}`)));\n  renderDynamicBlocks();\n}\n\nrenderApp();\n"]}